import React from 'react';
import { AgGridReact } from 'ag-grid-react';
import 'ag-grid-community/styles/ag-grid.css';
import 'ag-grid-community/styles/ag-theme-alpine.css';
import 'ag-grid-enterprise'; // Required for master/detail

const NestedAgGrid = () => {
  const rowData = [
    {
      orderId: 'ORD001',
      date: '2025-04-15',
      customer: 'John Doe',
      ruleName: 'High Value Alert',
      requestId: 'REQ-001',
      children: [
        {
          productName: 'Laptop',
          attribute: 'Color',
          recordName: 'Laptop-Red',
          changeType: 'Update',
          priority: 'High',
        },
        {
          productName: 'Mouse',
          attribute: 'Size',
          recordName: 'Mouse-Medium',
          changeType: 'Add',
          priority: 'Low',
        },
      ],
    },
  ];

  const parentColumns = [
    { field: 'orderId', headerName: 'Order Id' },
    { field: 'date', headerName: 'Date' },
    { field: 'customer', headerName: 'Customer' },
    { field: 'ruleName', headerName: 'Rule Name' },
    { field: 'requestId', headerName: 'Request Id' },
  ];

  const childColumns = [
    { field: 'productName', headerName: 'Product' },
    { field: 'attribute', headerName: 'Attribute' },
    { field: 'recordName', headerName: 'Record Name' },
    { field: 'changeType', headerName: 'Change Type' },
    { field: 'priority', headerName: 'Priority' },
  ];

  return (
    <div className="ag-theme-alpine" style={{ height: 600, width: '100%' }}>
      <AgGridReact
        rowData={rowData}
        columnDefs={parentColumns}
        masterDetail={true}
        detailCellRendererParams={{
          detailGridOptions: {
            columnDefs: childColumns,
            defaultColDef: { flex: 1 },
          },
          getDetailRowData: (params: any) => {
            params.successCallback(params.data.children || []);
          },
        }}
        defaultColDef={{ flex: 1, resizable: true }}
        domLayout="autoHeight"
      />
    </div>
  );
};

export default NestedAgGrid;